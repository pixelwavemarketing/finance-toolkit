<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Finance Toolkit – Evergreen Calculators</title>
  <meta name="description" content="Free, privacy‑friendly finance calculators: compound interest, debt payoff, savings rate, and more. 100% client‑side, no sign‑up." />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
  <style>
    :root {
      --bg:#0b1020; --card:#121a35; --muted:#94a3b8; --text:#e2e8f0; --accent:#60a5fa; --accent-2:#34d399; --border:#1f2a4a;
    }
    * { box-sizing:border-box; }
    body { margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; background:var(--bg); color:var(--text); }
    header { position:sticky; top:0; backdrop-filter:saturate(1.2) blur(6px); background:linear-gradient(180deg, rgba(11,16,32,.85), rgba(11,16,32,.6)); border-bottom:1px solid var(--border); z-index:10; }
    .container { max-width:1100px; margin:0 auto; padding:20px; }
    .brand { display:flex; align-items:center; gap:10px; }
    .brand h1 { margin:0; font-size:20px; letter-spacing:.2px; }
    nav { display:flex; gap:10px; flex-wrap:wrap; padding:10px 0; }
    nav a { text-decoration:none; color:var(--text); border:1px solid var(--border); padding:8px 12px; border-radius:12px; opacity:.9; }
    nav a.active, nav a:hover { border-color:var(--accent); color:#fff; box-shadow:0 0 0 2px rgba(96,165,250,.15) inset; }

    main { padding:24px 0 48px; }
    .grid { display:grid; grid-template-columns:1fr; gap:16px; }
    @media (min-width: 960px) { .grid { grid-template-columns: 360px 1fr; } }

    .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; }
    .card h2 { margin:0 0 8px 0; font-size:18px; }
    .desc { color:var(--muted); font-size:14px; margin-top:4px; }

    .field { display:flex; flex-direction:column; gap:6px; margin-bottom:12px; }
    .field label { font-size:13px; color:#cbd5e1; }
    .row { display:flex; gap:8px; }
    .row > * { flex:1; }
    input[type="number"], input[type="text"], select { width:100%; padding:10px 12px; background:#0f162e; color:var(--text); border:1px solid var(--border); border-radius:10px; }
    input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    .btn { border:1px solid var(--border); background:#0f162e; color:#fff; padding:10px 12px; border-radius:10px; cursor:pointer; }
    .btn:hover { border-color:var(--accent); }
    .btn.secondary { background:transparent; }

    .kpi { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .kpi .item { background:#0f162e; border:1px solid var(--border); border-radius:12px; padding:12px; }
    .kpi .label { color:var(--muted); font-size:12px; }
    .kpi .value { font-size:18px; margin-top:4px; }

    .muted { color:var(--muted); font-size:13px; }

    /* Fixed-height chart wrapper to prevent infinite growth */
    .chart-area { position:relative; height:260px; max-height:60vh; }
    .chart-area canvas { display:block; width:100% !important; height:100% !important; }

    .debts { display:flex; flex-direction:column; gap:10px; }
    .debt { border:1px dashed var(--border); border-radius:12px; padding:10px; background:#0e1530; }
    .debt .row { align-items:end; }
    .debt-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .link { color:var(--accent); cursor:pointer; text-decoration:none; }

    footer { border-top:1px solid var(--border); color:var(--muted); font-size:12px; padding:24px 0; }
  </style>
</head>
<body>
  <header>
    <div class="container brand">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v18M3 12h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <h1>Finance Toolkit</h1>
    </div>
    <div class="container">
      <nav id="nav"></nav>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <section class="card" id="form"></section>
      <section class="card" id="results"></section>
    </div>
    <div class="card" style="margin-top:16px;">
      <h2>Chart</h2>
      <div class="chart-area">
        <canvas id="chart"></canvas>
      </div>
    </div>
    <div class="card" style="margin-top:16px;">
      <h2>What this means</h2>
      <p class="muted" id="explainer">Select a calculator to begin.</p>
    </div>
  </main>

  <footer class="container">
    <div>Calculations run in your browser. We don't store your data or require accounts. Ads may collect data—see <a href="./privacy-policy.html" class="link">Privacy Policy</a>. Website built by <a href="https://usepixelwave.com" target="_blank" rel="noopener" class="link">pixelwave marketing</a> <span id="shareTarget"></span></div>
  </footer>

  <script>
    // ---------------------------------------------
    // UTILITIES
    // ---------------------------------------------
    const $$ = (q, el=document) => el.querySelector(q);
    const $$$ = (q, el=document) => Array.from(el.querySelectorAll(q));
    const fmtCurrency = (n) => n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2});
    const fmtNumber = (n, d=0) => n.toLocaleString(undefined,{maximumFractionDigits:d});
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const toNum = (v) => {
      if (typeof v === 'number') return v;
      if (v === '' || v == null) return 0;
      return Number(String(v).replace(/[^0-9.-]/g,'')) || 0;
    };
    const monthAdd = (date, m) => { const d=new Date(date); d.setMonth(d.getMonth()+m); return d; };

    function downloadCSV(filename, rows) {
      const csv = rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download=filename; a.click(); URL.revokeObjectURL(url);
    }

    async function copy(text){ try{ await navigator.clipboard.writeText(text);}catch(e){ console.log('Clipboard blocked'); } }

    // ---------------------------------------------
    // STATE IN URL (hash)
    // ---------------------------------------------
    function getHashParams(){
      const hash = location.hash.startsWith('#')? location.hash.slice(1) : location.hash;
      const pairs = new URLSearchParams(hash);
      const calc = pairs.get('calc') || 'compound-interest';
      const stateRaw = pairs.get('state');
      let state = {};
      if (stateRaw){ try{ state = JSON.parse(decodeURIComponent(stateRaw)); }catch(e){ state = {}; } }
      return { calc, state };
    }
    function setHashParams(calc, state){
      const pairs = new URLSearchParams();
      pairs.set('calc', calc);
      if (state && Object.keys(state).length) pairs.set('state', encodeURIComponent(JSON.stringify(state)));
      const newHash = '#' + pairs.toString();
      history.replaceState(null, '', newHash);
    }

    // ---------------------------------------------
    // CONFIG (Add calculators here)
    // ---------------------------------------------
    const CALCULATORS = {
      'compound-interest': {
        id:'compound-interest',
        title:'Compound Interest',
        description:'Estimate growth of an investment with recurring contributions and compounding.',
        explainer:`This calculator shows how your principal and ongoing contributions can grow over time. Adjust return and contribution to compare scenarios.`,
        inputs:[
          { name:'principal', label:'Starting Amount', type:'currency', min:0, step:100, default:10000 },
          { name:'contrib', label:'Monthly Contribution', type:'currency', min:0, step:50, default:200 },
          { name:'rate', label:'Annual Return (%)', type:'percent', min:0, max:50, step:.1, default:7 },
          { name:'years', label:'Years', type:'number', min:1, max:60, step:1, default:10 },
          { name:'compound', label:'Compounding', type:'select', options:[
            { value:'annual', label:'Annual' },
            { value:'monthly', label:'Monthly' },
            { value:'daily', label:'Daily (approx)' },
          ], default:'monthly' },
        ],
        compute:'computeCompoundInterest',
        outputs:[
          { name:'finalBalance', label:'Final Balance', format:'currency' },
          { name:'totalContrib', label:'Total Contributions', format:'currency' },
          { name:'totalGrowth', label:'Total Growth', format:'currency' },
        ],
        chart:{ x:'year', series:[{key:'balance', label:'Balance'}] }
      },
      'debt-payoff': {
        id:'debt-payoff',
        title:'Debt Payoff Planner',
        description:'Build a month‑by‑month plan using snowball or avalanche and optional extra payments.',
        explainer:`Paying debts by smallest balance (snowball) can build momentum; highest APR (avalanche) is interest‑optimal. This planner shows the timeline both ways.`,
        inputs:[
          { name:'strategy', label:'Strategy', type:'select', options:[
            {value:'snowball', label:'Snowball (smallest balance first)'},
            {value:'avalanche', label:'Avalanche (highest rate first)'}
          ], default:'snowball' },
          { name:'extra', label:'Extra Payment / month', type:'currency', min:0, step:25, default:100 },
          { name:'debts', label:'Debts', type:'repeater', of:[
            { name:'name', label:'Name', type:'text', default:'Card' },
            { name:'balance', label:'Balance', type:'currency', min:0, step:50, default:1500 },
            { name:'apr', label:'APR (%)', type:'percent', min:0, max:80, step:.1, default:19.99 },
            { name:'min', label:'Min Payment', type:'currency', min:0, step:10, default:50 },
          ], defaultRows:[
            { name:'Card A', balance:1500, apr:19.99, min:50 },
            { name:'Loan B', balance:5000, apr:7.0, min:120 }
          ]}
        ],
        compute:'computeDebtPayoff',
        outputs:[
          { name:'months', label:'Months to Debt‑Free', format:'number' },
          { name:'totalInterest', label:'Total Interest Paid', format:'currency' },
          { name:'debtFreeDate', label:'Debt‑Free Date', format:'text' },
        ],
        chart:{ x:'month', series:[{key:'totalBalance', label:'Total Balance'}] }
      }
    };

    // ---------------------------------------------
    // COMPUTE ENGINES
    // ---------------------------------------------
    function computeCompoundInterest(input){
      const P = toNum(input.principal);
      const C = toNum(input.contrib);
      const r = toNum(input.rate) / 100; // annual
      const years = clamp(toNum(input.years), 1, 100);
      const compound = input.compound || 'monthly';

      const periodsPerYear = compound === 'annual' ? 1 : (compound === 'monthly' ? 12 : 365);
      const dtMonths = 12; // timeline sampling monthly

      let balance = P;
      const timeline = [];
      const start = new Date();
      let totalContrib = 0;

      for (let m=1; m<=years*12; m++){
        // contribution monthly
        balance += C; totalContrib += C;
        // compound within month approximation
        const monthlyRate = r / 12;
        // If compounding more finely than monthly, approximate via effective rate
        balance *= (1 + monthlyRate);
        if (m % dtMonths === 0){
          const year = Math.floor(m/12);
          timeline.push({ year, balance: +balance.toFixed(2), date: monthAdd(start, m) });
        }
      }
      const finalBalance = +balance.toFixed(2);
      const totalGrowth = +(finalBalance - P - totalContrib).toFixed(2);
      return { finalBalance, totalContrib, totalGrowth, timeline };
    }

    function computeDebtPayoff(input){
      const strategy = input.strategy || 'snowball';
      const extra = Math.max(0, toNum(input.extra));
      let debts = Array.isArray(input.debts) ? input.debts.map(d=>({
        name: d.name || 'Debt', balance: Math.max(0,toNum(d.balance)), apr: Math.max(0,toNum(d.apr)), min: Math.max(0,toNum(d.min))
      })) : [];
      debts = debts.filter(d=>d.balance>0);
      if (!debts.length) return { months:0, totalInterest:0, debtFreeDate:'—', schedule:[], timeline:[] };

      const schedule = []; // per month snapshot
      let month = 0; let totalInterest = 0;
      const start = new Date();

      // Prevent infinite loop
      let safety = 0; const SAFETY_LIMIT = 3600; // 300 years

      while (debts.some(d=>d.balance>0) && safety++ < SAFETY_LIMIT){
        month++;
        // Accrue interest
        for (const d of debts){
          if (d.balance<=0) continue;
          const monthlyRate = d.apr/100/12;
          const interest = d.balance * monthlyRate;
          d.balance += interest; totalInterest += interest;
        }
        // Determine payment order
        let active = debts.filter(d=>d.balance>0);
        if (strategy==='snowball') active.sort((a,b)=>a.balance-b.balance);
        else active.sort((a,b)=>b.apr-a.apr);

        // Apply minimums
        let pool = extra + active.reduce((s,d)=>s + Math.min(d.min, d.balance), 0);
        for (const d of active){
          if (d.balance<=0) continue;
          const pay = Math.min(d.min, d.balance, pool);
          d.balance -= pay; pool -= pay;
        }
        // Roll remaining pool to the target debt
        active = debts.filter(d=>d.balance>0);
        if (active.length){
          if (strategy==='snowball') active.sort((a,b)=>a.balance-b.balance);
          else active.sort((a,b)=>b.apr-a.apr);
          let i=0;
          while (pool>0 && i<active.length){
            const d = active[i];
            const pay = Math.min(d.balance, pool);
            d.balance -= pay; pool -= pay; if (d.balance<=0) i++;
          }
        }

        schedule.push({ month, debts:debts.map(d=>({ name:d.name, balance:+d.balance.toFixed(2) })), totalBalance:+debts.reduce((s,d)=>s+d.balance,0).toFixed(2) });

        if (debts.every(d=>d.balance<=0)) break;
        if (month>6000) break; // absolute hard stop
      }

      const debtFreeDate = monthAdd(start, month).toLocaleDateString();
      const timeline = schedule.map(s=>({ month:s.month, totalBalance:s.totalBalance }));
      return { months: month, totalInterest: +totalInterest.toFixed(2), debtFreeDate, schedule, timeline };
    }

    const ENGINES = { computeCompoundInterest, computeDebtPayoff };

    // ---------------------------------------------
    // RENDERING
    // ---------------------------------------------
    const navEl = $('#nav'); const formEl = $('#form'); const resultsEl = $('#results');
    let chart;

    function $(id){ return document.getElementById(id.replace('#','')); }

    function renderNav(active){
      navEl.innerHTML = Object.values(CALCULATORS).map(c=>{
        const href = `#calc=${c.id}`; const cls = (c.id===active)?'active':'';
        return `<a href="${href}" class="${cls}">${c.title}</a>`;
      }).join('');
    }

    function fieldHTML(f, value){
      const v = value ?? f.default ?? '';
      const name = f.name;
      const label = `<label for="f_${name}">${f.label}</label>`;
      if (f.type==='select'){
        const opts = f.options.map(o=>`<option value="${o.value}" ${o.value===v?'selected':''}>${o.label}</option>`).join('');
        return `<div class="field"><div class="row"><div style="flex:1">${label}<select id="f_${name}" data-name="${name}">${opts}</select></div></div></div>`;
      }
      if (f.type==='repeater'){
        const rows = (value && Array.isArray(value) ? value : (f.defaultRows||[]));
        const rowHTML = rows.map((row, idx)=>
          `<div class="debt" data-idx="${idx}">
            <div class="debt-header"><strong>Item ${idx+1}</strong><span class="link" data-action="remove" data-idx="${idx}">Remove</span></div>
            <div class="row">${f.of.map(col=>{
              const rv = row[col.name] ?? col.default ?? '';
              return `<div class="field"><label>${col.label}</label>${inputEl(col, rv, `${name}.${idx}.${col.name}`)}</div>`;
            }).join('')}</div>
          </div>`
        ).join('');
        return `<div class="field"><label>${f.label}</label><div class="debts" id="rep_${name}">${rowHTML}</div><button class="btn" data-action="add-row" data-name="${name}">+ Add</button></div>`;
      }
      return `<div class="field">${label}${inputEl(f, v, name)}</div>`;
    }

    function inputEl(f, v, path){
      const id = `f_${path.replace(/\./g,'_')}`;
      const common = `id="${id}" data-name="${path}"`;
      if (f.type==='currency' || f.type==='percent' || f.type==='number'){
        const step = f.step!=null? ` step="${f.step}"` : '';
        const min = f.min!=null? ` min="${f.min}"` : '';
        const max = f.max!=null? ` max="${f.max}"` : '';
        const val = (typeof v==='number')? v : (v||'');
        return `<input type="number" inputmode="decimal" ${common} value="${val}"${step}${min}${max}/>`;
      }
      if (f.type==='text') return `<input type="text" ${common} value="${v||''}"/>`;
      // default
      return `<input type="text" ${common} value="${v||''}"/>`;
    }

    function getFormState(config){
      const state = {};
      for (const f of config.inputs){
        if (f.type==='repeater'){
          const container = document.getElementById(`rep_${f.name}`);
          const blocks = $$$('.debt', container);
          state[f.name] = blocks.map((b)=>{
            const row = {};
            for (const col of f.of){
              const inp = $$(`[data-name="${f.name}.${b.dataset.idx}.${col.name}"]`, b);
              row[col.name] = (col.type==='currency'||col.type==='percent'||col.type==='number')? toNum(inp.value) : inp.value;
            }
            return row;
          });
        } else {
          const el = $$(`[data-name="${f.name}"]`, formEl);
          const raw = el?.value ?? f.default;
          state[f.name] = (f.type==='currency'||f.type==='percent'||f.type==='number')? toNum(raw) : raw;
        }
      }
      return state;
    }

    function setFormState(config, state){
      for (const f of config.inputs){
        if (f.type==='repeater'){
          // Re-render repeater
          const html = fieldHTML(f, state[f.name]);
          const wrapper = document.getElementById(`rep_${f.name}`)?.parentElement;
          if (wrapper){ wrapper.outerHTML = html; }
        } else {
          const sel = $$(`[data-name="${f.name}"]`, formEl);
          if (sel) sel.value = state[f.name] ?? f.default ?? '';
        }
      }
    }

    function renderForm(config, state){
      formEl.innerHTML = `<h2>${config.title}</h2><p class="desc">${config.description}</p>` +
        config.inputs.map(f => fieldHTML(f, state[f.name])).join('') +
        `<div class="row">
          <button class="btn" id="btnRun">Recalculate</button>
          <button class="btn secondary" id="btnCSV">Download CSV</button>
          <button class="btn secondary" id="btnShare">Copy Share Link</button>
        </div>`;

      formEl.addEventListener('click', (e)=>{
        const t = e.target;
        if (t.matches('[data-action="add-row"]')){
          const name = t.getAttribute('data-name');
          const f = config.inputs.find(x=>x.name===name);
          const container = document.getElementById(`rep_${name}`);
          const idx = container.children.length;
          const row = {};
          for (const col of f.of){ row[col.name] = col.default ?? '' }
          const div = document.createElement('div');
          div.className='debt'; div.dataset.idx=String(idx);
          div.innerHTML = `<div class="debt-header"><strong>Item ${idx+1}</strong><span class="link" data-action="remove" data-idx="${idx}">Remove</span></div>
            <div class="row">${f.of.map(col=>`<div class="field"><label>${col.label}</label>${inputEl(col, row[col.name], `${name}.${idx}.${col.name}`)}</div>`).join('')}</div>`;
          container.appendChild(div);
        }
        if (t.matches('[data-action="remove"]')){
          const idx = Number(t.getAttribute('data-idx'));
          const box = t.closest('.debt'); box?.remove();
        }
      });

      // Bind actions
      $('#btnRun').addEventListener('click', ()=> run(config));
      $('#btnCSV').addEventListener('click', ()=> download(config));
      $('#btnShare').addEventListener('click', ()=> share(config));

      // Auto-run
      run(config);
    }

    function renderResults(config, results){
      const kpi = (n,l,fmt) => `<div class="item"><div class="label">${l}</div><div class="value">${fmt?fmt(n):n}</div></div>`;
      resultsEl.innerHTML = `<h2>Results</h2>
        <div class="kpi">${config.outputs.map(o=>{
          const v = results[o.name];
          const format = (o.format==='currency')? fmtCurrency : (o.format==='number'? (x)=>fmtNumber(x,0) : (x)=>x);
          return kpi(v, o.label, format);
        }).join('')}</div>
        <p class="muted" style="margin-top:8px;">Tip: tweak one input at a time to see how your timeline changes.</p>`;

      // Chart (update in place to avoid reflow/resizer loops)
      const canvas = $('#chart');
      const labels = results.timeline.map(p=>p[(config.chart.x)]);
      const data = results.timeline.map(p=>p[config.chart.series[0].key]);
      if (!chart) {
        chart = new Chart(canvas, {
          type: 'line',
          data: { labels, datasets: [{ label: config.chart.series[0].label, data, fill: false }] },
          options: { responsive: true, maintainAspectRatio: false, animation: false, plugins: { legend: { display: true } } }
        });
      } else {
        chart.data.labels = labels;
        chart.data.datasets[0].label = config.chart.series[0].label;
        chart.data.datasets[0].data = data;
        chart.update();
      }

      // Explainer
      $('#explainer').textContent = CALCULATORS[current.calc].explainer;
    }

    function run(config){
      const state = getFormState(config);
      setHashParams(config.id, state);
      const fn = ENGINES[config.compute];
      const results = fn(state);
      renderResults(config, results);
      window.__lastResults = results; // for CSV
    }

    function download(config){
      const results = window.__lastResults || {};
      let rows = [];
      if (config.id==='compound-interest'){
        rows = [['Year','Balance']].concat(results.timeline.map(p=>[p.year, p.balance]));
      } else if (config.id==='debt-payoff'){
        rows = [['Month','Total Balance']].concat(results.timeline.map(p=>[p.month, p.totalBalance]));
      }
      downloadCSV(`${config.id}.csv`, rows);
    }

    function share(config){
      const url = location.origin + location.pathname + location.hash;
      copy(url); const tgt = document.getElementById('shareTarget');
      tgt.textContent = 'Link copied to clipboard ✔'; setTimeout(()=>tgt.textContent='', 3000);
    }

    // ---------------------------------------------
    // BOOT
    // ---------------------------------------------
    let current = getHashParams();
    renderNav(current.calc);

    function selectCalc(id){
      const config = CALCULATORS[id];
      if (!config) return;
      const state = Object.assign({}, Object.fromEntries(config.inputs.map(f=>[f.name, f.default])), current.state||{});
      renderForm(config, state);
      $('#explainer').textContent = config.explainer;
      $$$('#nav a').forEach(a=>a.classList.toggle('active', a.getAttribute('href') === `#calc=${id}`));
      current = { calc:id, state };
    }

    window.addEventListener('hashchange', ()=>{ current = getHashParams(); selectCalc(current.calc); });

    // init
    selectCalc(current.calc);
  </script>

  <!-- Optional: Basic FAQ schema template you can customize per page -->
  <script type="application/ld+json">
    {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[
      {"@type":"Question","name":"Is this site private?","acceptedAnswer":{"@type":"Answer","text":"Yes. All calculations run in your browser. We do not store your data."}},
      {"@type":"Question","name":"Do I need an account?","acceptedAnswer":{"@type":"Answer","text":"No. There are no accounts or sign‑ups required."}}
    ]}
  </script>
</body>
</html>
